# CLAUDE.md - AI Agent Documentation

## Important Notes for AI Agents

**⚠️ CRITICAL: When reading project assets, follow these rules:**
- **ONLY read image and audio file NAMES and FOLDERS**
- **NEVER read the actual CONTENT of image files** (`.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, etc.)
- **NEVER read the actual CONTENT of audio files** (`.mp3`, `.wav`, `.ogg`, `.m4a`, etc.)
- Reading image/audio content wastes significant tokens without providing useful information
- Focus on C# scripts, prefabs, and scene files for understanding the project

---

## Project Overview

**2D Chess-Meets-Shooter Mobile Game**

This Unity 2D project is a hybrid tactical game combining:
1. **Chess Mode**: Hexagonal grid-based tactical movement with opponent AI
2. **Standoff Mode**: 2D side-scrolling platformer with shooting mechanics and SUPERHOT-style slow motion

**Unity Version**: 6000.4.0a4

**Game Inspirations:**
- **Shotgun King: The Final Checkmate** - Chess mechanics reversed (player is the shotgun king)
- **Fights in Tight Spaces** - Enemy modifiers and tactical card-based combat
- **SUPERHOT** - Time manipulation mechanics (time moves when you move)
- **Terraria** - Side-scrolling platformer combat style

---

## Game Flow

```
Main Menu
    ↓
Level Selection
    ↓
Chess Mode (Hex Grid)
    → Player: Swipe to move in 6 hex directions
    → Opponents: AI-driven pawns with guns (Basic, Handcannon, Shotgun, Sniper)
    → Combat: Walk onto opponent to capture, opponents shoot at player
    ↓
(When only 1 opponent remains)
    ↓
Standoff Mode (2D Platformer)
    → Arena generation: Hexagonal platforms at varying heights
    → Player: Joystick movement + jump button
    → Opponent: AI platforming with shooting
    → Time: Slow motion when player idle (SUPERHOT style)
    → Win condition: Touch the opponent to capture
    ↓
Victory/Defeat Screen
    → Next level or retry
```

---

## Architecture Overview

### Core Systems (15 Consolidated Scripts)

The codebase has been consolidated from 27 scripts to 15 for better maintainability:

1. **GameManager.cs** - Unified game state and level management (merged GameStateManager + LevelManager)
   - States: MainMenu, LevelSelect, ChessMode, Standoff, Victory, Defeat, Paused
   - Handles level loading, configuration, and visual settings

2. **LevelData.cs** - ScriptableObject for level presets (3 levels)

3. **AudioManager.cs** - Singleton for music and SFX management
   - Supports fade transitions and volume control

4. **TimeController.cs** - SUPERHOT-style slow motion in Standoff mode
   - Slows time when player stops moving

5. **PawnHealth.cs** - Unified health system (merged PlayerPawn + OpponentPawn)
   - Handles HP, damage, death, and visual feedback for both player and opponents

6. **SpawnerSystem.cs** - Unified spawning (merged PlayerSpawner + PawnSpawner)
   - Spawns player at bottom-right, opponents in upper tiles with weighted probability

7. **WeaponSystem.cs** - Unified weapon handling (merged Firearm + Projectile + GunAiming)
   - Fire modes: Manual, OnLineOfSight, TrackPlayer, Timed
   - Projectile types: Single, Spread, Beam
   - Includes ProjectileBehavior as nested class

8. **InputSystem.cs** - Unified input (merged MobileInputManager + VirtualJoystick)
   - Mobile touch joystick and desktop keyboard fallback

9. **UIManager.cs** - Unified UI (merged 6 UI scripts)
   - Main menu, level select, game HUD, pause menu, victory/defeat, settings

10. **Player Controller.cs** - Player movement in both modes
    - Chess: Swipe-based hex movement
    - Standoff: Rigidbody2D platformer physics

11. **Pawn Controller.cs** - Opponent AI in both modes
    - Chess: Weighted directional decision-making
    - Standoff: Platformer AI with jump detection

12. **Chequerboard.cs** - Turn-based coordination

13. **HexGrid Generator.cs** - Procedural hex grid generation

14. **Platform.cs** - Procedural Standoff arena generation

15. **Follow Camera.cs** - Orthographic camera with zoom pulse effects

---

## Game Modes

### Chess Mode

**Grid System:**
- Hexagonal grid (axial coordinates: q, r)
- Two orientations: FlatTop, PointyTop
- Generated by `HexGrid Generator.cs`

**Player:**
- `Player Controller.cs`: Swipe-based movement
- `PawnHealth.cs` (PawnType.Player): Health with sprite-based HP display
- 6-directional movement on hex grid
- Capture opponents by moving onto their tile

**Opponents:**
- `Pawn Controller.cs`: AI decision-making
- `PawnHealth.cs` (PawnType.Opponent): Health, death effects, physics expulsion
- 4 AI types:
  - **Basic**: Moves toward player (limited to 3 bottom directions, cannot move backward/upward)
  - **Handcannon**: Mid-range specialist, prefers closest tiles
  - **Shotgun**: Aggressive attacker (strongly prefers moving toward player)
  - **Sniper**: Defensive, prefers farthest tiles

**Shooting Mechanics:**
- `WeaponSystem.cs`: Handles weapons, projectiles, and gun aiming
- Fire modes: Manual, OnLineOfSight, TrackPlayer, Timed
- Projectile types: Single, Spread, Beam

---

### Standoff Mode

**Arena Generation:**
- `Platform.cs`: Procedural hex-based platform generation
- Algorithm:
  1. Spawn floor tiles (6 default, with direction constraints)
  2. Generate platform 2 tiles above selected floor tile
  3. Mirror all tiles left-to-right
  4. Add 3 random connecting tiles

**Player:**
- Modified `Player Controller.cs` with platformer physics
- Rigidbody2D-based movement
- Jump mechanics with ground detection
- Mobile: Virtual joystick + jump button
- Desktop: WASD/Arrows + Space

**Opponent AI:**
- Modified `Pawn Controller.cs` with platformer AI
- Intelligent jumping (obstacles, gaps, platforms)
- Distance-based behavior:
  - Basic/Shotgun: Aggressive (always approach player)
  - Handcannon: Mid-range (maintain 2-4 unit distance)
  - Sniper: Defensive (retreat when too close)
- Edge detection to avoid falling

**Time Mechanics:**
- `TimeController.cs`: Slow motion system
- Normal time when player moves
- Slow motion (0.1x) when player idle
- Smooth transitions with adjustable speed

---

## Code Structure

### Consolidated Folder Layout
```
Assets/
├── Script/                    # 15 Consolidated Scripts
│   ├── Core Systems:
│   │   ├── GameManager.cs     # Game state + Level management
│   │   ├── LevelData.cs       # ScriptableObject
│   │   ├── AudioManager.cs
│   │   ├── TimeController.cs
│   │
│   ├── Gameplay:
│   │   ├── Player Controller.cs
│   │   ├── Pawn Controller.cs
│   │   ├── PawnHealth.cs      # Player + Opponent health
│   │   ├── Chequerboard.cs
│   │   ├── HexGrid Generator.cs
│   │   ├── SpawnerSystem.cs   # Player + Opponent spawning
│   │   ├── Platform.cs
│   │   ├── WeaponSystem.cs    # Firearm + Projectile + GunAiming
│   │
│   ├── Input & UI:
│   │   ├── InputSystem.cs     # Mobile + Desktop input
│   │   ├── UIManager.cs       # All UI screens
│   │
│   └── Utilities:
│       └── Follow Camera.cs
│
├── Prefab/
│   ├── Default Tile.prefab
│   ├── Player Pawn.prefab
│   ├── Pawn.prefab (Basic)
│   ├── Pawn Hand Cannon.prefab
│   ├── Pawn Shotgun.prefab
│   └── Pawn Sniper.prefab
│
├── Sprite/
├── Audio/
└── Main Scene.unity
```

---

## Key Design Patterns

### 1. Singleton Pattern
Used for global managers:
- `GameManager.Instance`
- `AudioManager.Instance`
- `TimeController.Instance`
- `InputSystem.Instance`
- `UIManager.Instance`
- `Checkerboard.Instance`
- `FollowCamera.Instance`

### 2. Component-Based Architecture
Each GameObject has focused components:
- Health: `PawnHealth.cs` (with PawnType enum)
- Movement: `Player Controller.cs`, `Pawn Controller.cs`
- Weapons: `WeaponSystem.cs`

### 3. Mode Switching
Controllers support both modes:
```csharp
// Switch player to Standoff mode
playerController.SetStandoffMode(true);

// Switch opponent to Standoff mode
pawnController.SetStandoffMode(true);
weaponSystem.SetStandoffMode(true);
```

### 4. Event-Driven Communication
Using UnityEvents:
```csharp
// Health changes
PawnHealth.OnHPChanged.AddListener(OnHealthChanged);

// Game state changes
GameManager.OnStateChanged.AddListener(HandleStateChange);
GameManager.OnVictory.AddListener(ShowVictoryScreen);
```

---

## Coordinate Systems

### Chess Mode (Axial Hexagonal)
```
Axial Coordinates (q, r):
- q: Horizontal offset
- r: Vertical offset
- Neighbor deltas: {(1,0), (1,-1), (0,-1), (-1,0), (-1,1), (0,1)}

Conversion to world position:
FlatTop:
  x = sqrt(3) * tileSize * (q + r/2)
  y = (3/2) * tileSize * r

PointyTop:
  x = (3/2) * tileSize * q
  y = sqrt(3) * tileSize * (r + q/2)
```

### Standoff Mode (World Space)
- Standard Unity 2D world coordinates
- Rigidbody2D physics
- Gravity: 2f (adjustable)

---

## AI Systems

### Chess Mode AI Weights

**Basic:**
- Allowed directions: (0,-1), (-1,0), (1,-1) - bottom 3 directions only
- **Cannot move backward** (upward in world space y-axis)
- Closest to player: weight 5
- Others: weight 1
- Behaves like chess pawns (forward only, never backward)

**Handcannon:**
- All 6 directions allowed
- Closest: weight 3
- Others: weight 1
- Mid-range specialist

**Shotgun:**
- All 6 directions allowed
- **Aggressive directional weighting:**
  - Closest to player: weight 4 (highest priority)
  - Top-right and top-left: weight 3
  - Bottom-right and bottom-left: weight 2
  - Farthest from player: weight 1
- Strongly favors moving toward player

**Sniper:**
- All 6 directions
- Farthest: weight 4
- Closest: weight 1
- Others: weight 2
- Defensive positioning

### Standoff Mode AI Behavior

**Decision-making (0.5s intervals):**
1. Calculate distance to player
2. Choose movement direction based on AI type:
   - **Basic/Shotgun**: Aggressive - always approach player
   - **Handcannon**: Mid-range - maintain 2-4 unit distance
   - **Sniper**: Defensive - retreat when player gets too close
3. Perform jump checks:
   - Obstacle detection (forward raycast)
   - Edge detection (downward raycast)
   - Gap jumping (far ground check)

---

## Mobile Controls

### Chess Mode
- Touch anywhere on screen
- Swipe in desired direction
- Visual arrow feedback during swipe
- Dead zone: 24 pixels

### Standoff Mode
- **Virtual Joystick**: Movement (left side of screen)
- **Jump Button**: Jump action (right side of screen)
- **Desktop Fallback**: WASD/Arrows + Space

---

## Inspector Configuration

All values are exposed in the Unity Inspector with tooltips:

**Example (PlayerController):**
```csharp
[Header("Chess Mode")]
[Tooltip("Movement animation duration")]
public float moveDuration = 0.12f;

[Header("Standoff Mode Settings")]
[Tooltip("Movement speed in Standoff mode")]
public float standoffMoveSpeed = 5f;

[Tooltip("Jump force")]
public float jumpForce = 10f;
```

---

## Level Configuration

Create new levels using ScriptableObjects:

1. Right-click in Project → Create → Game → Level Data
2. Configure:
   - Grid settings (radius, extraRows, tileSize)
   - Opponent counts (Basic, Handcannon, Shotgun, Sniper)
   - Player HP (starting, max)
   - Platform settings (floorTiles, platformExpansions)
   - Difficulty (fireRate, detectionRange)
   - Audio/Visual (music, skybox)

3. Add to `GameManager.levels[]` array

---

## Performance Considerations

### Optimizations Applied
1. **Script Consolidation**: 27 scripts → 15 scripts (44% reduction)
2. **Raycasts**: Limited frequency (AI thinks every 0.5s)
3. **Coroutines**: Used for smooth animations instead of Update loops
4. **Camera bounds caching**: Follow Camera calculates bounds once
5. **Input caching**: InputSystem caches references

### Token Preservation for AI Agents
- **Never read image files**: Sprites, textures, icons
- **Never read audio files**: Music, SFX
- **Only read C# scripts** for code analysis
- **List asset names** without reading content

---

## Common Tasks

### Adding a New AI Type
1. Add enum value to `PawnController.AIType`
2. Add case to `ApplyCombinedWeights()` in `Pawn Controller.cs`
3. Add case to `MakeStandoffDecision()` in `Pawn Controller.cs`
4. Create prefab with configured `PawnController` and `WeaponSystem`
5. Add to level configuration

### Adding a New Level
1. Create `LevelData` ScriptableObject
2. Configure all parameters
3. Add to `GameManager.levels[]`
4. Level buttons auto-generate in UIManager

### Adding a New Firearm Mode
1. Add enum value to `WeaponSystem.FireMode`
2. Implement logic in `WeaponSystem.HandleFireModes()`
3. Test in both Chess and Standoff modes

### Modifying Platform Generation
1. Edit `Platform.cs` parameters
2. Adjust `GenerateFloorTiles()` for floor layout
3. Modify `GeneratePlatform()` for platform placement
4. Update `MirrorTiles()` for symmetry rules

---

## Testing Workflow

### Chess Mode Testing
1. Verify hex grid generation
2. Test player swipe movement in all 6 directions
3. Test opponent AI for each type
4. Verify turn-based system (Checkerboard)
5. Test opponent shooting (WeaponSystem)
6. Verify player/opponent capture mechanics
7. Test HP system and death

### Standoff Mode Testing
1. Verify platform generation (symmetry, connectivity)
2. Test player platformer controls (movement, jump)
3. Test opponent AI platforming (jumping, edge detection)
4. Verify slow motion effect (move vs idle)
5. Test shooting mechanics
6. Verify win condition (touch opponent)
7. Test transition from Chess → Standoff

### UI Testing
1. Main menu navigation
2. Level selection
3. In-game HUD updates
4. Pause/resume functionality
5. Victory/defeat screens
6. Settings (volume controls)
7. Mobile controls visibility (auto-detect)

---

## Known Limitations

1. **3 Levels Maximum**: Currently configured for 3 levels
2. **Single Opponent in Standoff**: Only supports 1v1 Standoff
3. **Hex Orientation**: Grid uses FlatTop by default
4. **Physics 2D**: Requires Unity Physics 2D package
5. **TextMeshPro**: UI requires TextMeshPro package

---

## Dependencies

- **Unity Version**: 6000.4.0a4 (Unity 6 Alpha)
- **Required Packages**:
  - TextMeshPro
  - Input System (new)
  - 2D Physics

---

## Code Style

- **Naming**: PascalCase for public fields and methods
- **Tooltips**: All public Inspector fields have tooltips
- **Regions**: Code organized with `#region` blocks
- **Comments**: Inline comments for clarity
  - **DO NOT use `/// <summary>` XML documentation comments**
  - Use regular `//` comments for code explanations
  - Keep comments concise and focused on the "why" rather than the "what"

---

## Debugging Tips

### Chess Mode Issues
- Check `Checkerboard.IsPlayerTurn()` for turn management
- Verify hex coordinates with `Debug.Log($"q={q}, r={r}")`
- Use `showDebug` flags in controllers
- Check tile names: "Hex_{q}_{r}"

### Standoff Mode Issues
- Verify Rigidbody2D configuration (non-kinematic, gravity=2)
- Check ground layer mask settings
- Test ground detection raycasts (enable Gizmos)
- Verify TimeController.Instance is active

### UI Issues
- Check singleton initialization order
- Verify UnityEvent connections in Inspector
- Test with both mobile and desktop input

---

## Future Enhancement Ideas

1. **More AI Types**: Add specialized behaviors
2. **Power-ups**: Chess mode pickups
3. **Modifiers**: "Fights in Tight Spaces" style modifiers
4. **More Levels**: Expand beyond 3 levels
5. **Multiplayer**: Local or online
6. **Procedural Levels**: Random hex grid layouts
7. **Boss Battles**: Multi-phase Standoff encounters
8. **Replay System**: Record and replay games

---

## Contact & Attribution

This project was developed as a prototype for a 2D Mobile Game Development assignment.

**Game Inspirations:**
- **Shotgun King: The Final Checkmate** - Chess + Shooting mechanics (reversed concept)
- **Fights in Tight Spaces** - Enemy modifiers and tactical gameplay
- **SUPERHOT** - Time manipulation mechanics (time moves when you move)
- **Terraria** - Side-scrolling platformer combat style

---

*Last Updated: 2025-12-09*
*Unity Version: 6000.4.0a4*
*Total Scripts: 15 (Consolidated)*
*Total Lines of Code: 5000+*
