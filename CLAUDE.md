# CLAUDE.md - AI Agent Documentation

## Important Notes for AI Agents

**⚠️ CRITICAL: When reading project assets, follow these rules:**
- **ONLY read image and audio file NAMES and FOLDERS**
- **NEVER read the actual CONTENT of image files** (`.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, etc.)
- **NEVER read the actual CONTENT of audio files** (`.mp3`, `.wav`, `.ogg`, `.m4a`, etc.)
- Reading image/audio content wastes significant tokens without providing useful information
- Focus on C# scripts, prefabs, and scene files for understanding the project

---

## Project Overview

**2D Chess-Meets-Shooter Mobile Game**

This Unity 2D project is a hybrid tactical game combining:
1. **Chess Mode**: Hexagonal grid-based tactical movement with opponent AI
2. **Standoff Mode**: 2D side-scrolling platformer with shooting mechanics and SUPERHOT-style slow motion

The game was inspired by "Shotgun King: The Final Checkmate" (reversed) and "Fights in Tight Spaces" (enemy modifiers).

---

## Game Flow

```
Main Menu
    ↓
Level Selection
    ↓
Chess Mode (Hex Grid)
    → Player: Swipe to move in 6 hex directions
    → Opponents: AI-driven pawns with guns (Basic, Handcannon, Shotgun, Sniper)
    → Combat: Walk onto opponent to capture, opponents shoot at player
    ↓
(When only 1 opponent remains)
    ↓
Standoff Mode (2D Platformer)
    → Arena generation: Hexagonal platforms at varying heights
    → Player: Joystick movement + jump button
    → Opponent: AI platforming with shooting
    → Time: Slow motion when player idle (SUPERHOT style)
    → Win condition: Touch the opponent to capture
    ↓
Victory/Defeat Screen
    → Next level or retry
```

---

## Architecture Overview

### Core Systems

1. **Game State Management**
   - `GameStateManager.cs`: Controls overall game flow and mode transitions
   - States: MainMenu, LevelSelect, ChessMode, Standoff, Victory, Defeat, Paused

2. **Level Management**
   - `LevelManager.cs`: Handles level loading and configuration
   - `LevelData.cs`: ScriptableObject for level presets (3 levels)

3. **Time Control**
   - `TimeController.cs`: SUPERHOT-style slow motion in Standoff mode
   - Slows time when player stops moving

4. **Audio System**
   - `AudioManager.cs`: Singleton for music and SFX management
   - Supports fade transitions and volume control

---

## Game Modes

### Chess Mode

**Grid System:**
- Hexagonal grid (axial coordinates: q, r)
- Two orientations: FlatTop, PointyTop
- Generated by `HexGridGenerator.cs`

**Player:**
- `PlayerController.cs`: Swipe-based movement
- `PlayerPawn.cs`: Health management with sprite-based HP display
- 6-directional movement on hex grid
- Capture opponents by moving onto their tile

**Opponents:**
- `PawnController.cs`: AI decision-making
- `OpponentPawn.cs`: Health, death effects, physics expulsion
- 4 AI types:
  - **Basic**: Moves toward player (limited to 3 bottom directions)
  - **Handcannon**: Aggressive, prefers closest tiles
  - **Shotgun**: Medium range, avoids farthest tiles
  - **Sniper**: Defensive, prefers farthest tiles

**Shooting Mechanics:**
- `Firearm.cs`: Opponent weapons
- Fire modes: Manual, OnLineOfSight, TrackPlayer, Timed
- Projectile types: Single, Spread, Beam
- `Projectile.cs`: Bullet physics and collision

---

### Standoff Mode

**Arena Generation:**
- `Platform.cs`: Procedural hex-based platform generation
- Algorithm:
  1. Spawn floor tiles (6 default, with direction constraints)
  2. Generate platform 2 tiles above selected floor tile
  3. Mirror all tiles left-to-right
  4. Add 3 random connecting tiles

**Player:**
- Modified `PlayerController.cs` with platformer physics
- Rigidbody2D-based movement
- Jump mechanics with ground detection
- Mobile: Virtual joystick + jump button
- Desktop: WASD/Arrows + Space

**Opponent AI:**
- Modified `PawnController.cs` with platformer AI
- Intelligent jumping (obstacles, gaps, platforms)
- Distance-based behavior:
  - Basic/Handcannon: Aggressive (approach)
  - Shotgun: Medium range (maintain distance)
  - Sniper: Defensive (retreat)
- Edge detection to avoid falling

**Time Mechanics:**
- `TimeController.cs`: Slow motion system
- Normal time when player moves
- Slow motion (0.1x) when player idle
- Smooth transitions with adjustable speed

---

## UI System

**Scripts:**
- `MainMenuUI.cs`: Start screen
- `LevelSelectUI.cs`: Level selection
- `GameUI.cs`: In-game HUD (HP, level info, opponents count, mode indicator)
- `PauseMenuUI.cs`: Pause functionality
- `FinishMenuUI.cs`: Victory/defeat screens
- `SettingsUI.cs`: Volume controls

**Mobile Input:**
- `VirtualJoystick.cs`: On-screen joystick
- `MobileInputManager.cs`: Unified input system (mobile + keyboard fallback)

---

## Code Structure

### Folder Layout
```
Assets/
├── Script/
│   ├── Core Systems:
│   │   ├── GameStateManager.cs
│   │   ├── LevelManager.cs
│   │   ├── LevelData.cs (ScriptableObject)
│   │   ├── AudioManager.cs
│   │   ├── TimeController.cs
│   │
│   ├── Chess Mode:
│   │   ├── Player Controller.cs
│   │   ├── Player Pawn.cs
│   │   ├── Pawn Controller.cs (Opponent AI)
│   │   ├── Opponent Pawn.cs
│   │   ├── Checkerboard.cs (Turn management)
│   │   ├── HexGrid Generator.cs
│   │   ├── Player Spawner.cs
│   │   ├── Pawn Spawner.cs
│   │
│   ├── Standoff Mode:
│   │   ├── Platform.cs (Arena generation)
│   │   ├── Firearm.cs
│   │   ├── Projectile.cs
│   │
│   ├── Input:
│   │   ├── VirtualJoystick.cs
│   │   ├── MobileInputManager.cs
│   │
│   ├── UI:
│   │   ├── MainMenuUI.cs
│   │   ├── LevelSelectUI.cs
│   │   ├── GameUI.cs
│   │   ├── PauseMenuUI.cs
│   │   ├── FinishMenuUI.cs
│   │   ├── SettingsUI.cs
│   │
│   └── Utilities:
│       ├── Follow Camera.cs
│       └── Change Skybox.cs
│
├── Prefab/
│   ├── Default Tile.prefab
│   ├── Player Pawn.prefab
│   ├── Pawn.prefab (Basic)
│   ├── Pawn Hand Cannon.prefab
│   ├── Pawn Shotgun.prefab
│   └── Pawn Sniper.prefab
│
├── Sprite/
├── Audio/
└── Main Scene.unity
```

---

## Key Design Patterns

### 1. Singleton Pattern
Used for global managers:
- `GameStateManager.Instance`
- `LevelManager.Instance`
- `AudioManager.Instance`
- `TimeController.Instance`
- `MobileInputManager.Instance`
- `Checkerboard.Instance`

### 2. Component-Based Architecture
Each GameObject has focused, single-responsibility components:
- Health: `PlayerPawn.cs`, `OpponentPawn.cs`
- Movement: `PlayerController.cs`, `PawnController.cs`
- Shooting: `Firearm.cs`

### 3. Mode Switching
Controllers support both modes:
```csharp
// Switch player to Standoff mode
playerController.SetStandoffMode(true);

// Switch opponent to Standoff mode
pawnController.SetStandoffMode(true);
```

### 4. Event-Driven Communication
Using UnityEvents:
```csharp
// Player HP changes
PlayerPawn.OnHPChanged.AddListener(OnHealthChanged);

// Game state changes
GameStateManager.OnStateChanged.AddListener(HandleStateChange);
GameStateManager.OnVictory.AddListener(ShowVictoryScreen);
```

---

## Coordinate Systems

### Chess Mode (Axial Hexagonal)
```
Axial Coordinates (q, r):
- q: Horizontal offset
- r: Vertical offset
- Neighbor deltas: {(1,0), (1,-1), (0,-1), (-1,0), (-1,1), (0,1)}

Conversion to world position:
FlatTop:
  x = sqrt(3) * tileSize * (q + r/2)
  y = (3/2) * tileSize * r

PointyTop:
  x = (3/2) * tileSize * q
  y = sqrt(3) * tileSize * (r + q/2)
```

### Standoff Mode (World Space)
- Standard Unity 2D world coordinates
- Rigidbody2D physics
- Gravity: 2f (adjustable)

---

## AI Systems

### Chess Mode AI Weights

**Basic:**
- Allowed directions: (0,-1), (-1,0), (1,-1)
- Closest to player: weight 5
- Others: weight 1

**Handcannon:**
- All 6 directions allowed
- Closest: weight 3
- Others: weight 1

**Shotgun:**
- All 6 directions
- Closest: weight 3
- Farthest: weight 0
- Others: weight 1

**Sniper:**
- All 6 directions
- Farthest: weight 4
- Closest: weight 1
- Others: weight 2

### Standoff Mode AI Behavior

**Decision-making (0.5s intervals):**
1. Calculate distance to player
2. Choose movement direction based on AI type:
   - Basic/Handcannon: Approach if distance > 2
   - Shotgun: Maintain 2-4 unit range
   - Sniper: Retreat if distance < 5
3. Perform jump checks:
   - Obstacle detection (forward raycast)
   - Edge detection (downward raycast)
   - Gap jumping (far ground check)

---

## Mobile Controls

### Chess Mode
- Touch anywhere on screen
- Swipe in desired direction
- Visual arrow feedback during swipe
- Dead zone: 24 pixels

### Standoff Mode
- **Virtual Joystick**: Movement (left side of screen)
- **Jump Button**: Jump action (right side of screen)
- **Desktop Fallback**: WASD/Arrows + Space

---

## Inspector Configuration

All values are exposed in the Unity Inspector with tooltips:

**Example (PlayerController):**
```csharp
[Header("Chess Mode")]
[Tooltip("Movement animation duration")]
public float moveDuration = 0.12f;

[Header("Standoff Mode Settings")]
[Tooltip("Movement speed in Standoff mode")]
public float standoffMoveSpeed = 5f;

[Tooltip("Jump force")]
public float jumpForce = 10f;
```

---

## Level Configuration

Create new levels using ScriptableObjects:

1. Right-click in Project → Create → Game → Level Data
2. Configure:
   - Grid settings (radius, extraRows, tileSize)
   - Opponent counts (Basic, Handcannon, Shotgun, Sniper)
   - Player HP (starting, max)
   - Platform settings (floorTiles, platformExpansions)
   - Difficulty (fireRate, detectionRange)
   - Audio/Visual (music, skybox)

3. Add to `LevelManager.levels[]` array

---

## Performance Considerations

### Optimizations Applied
1. **Object pooling**: Consider implementing for projectiles
2. **Raycasts**: Limited frequency (AI thinks every 0.5s)
3. **Coroutines**: Used for smooth animations instead of Update loops
4. **Camera bounds caching**: Follow Camera calculates bounds once
5. **Input caching**: Mobile input manager caches references

### Token Preservation for AI Agents
- **Never read image files**: Sprites, textures, icons
- **Never read audio files**: Music, SFX
- **Only read C# scripts** for code analysis
- **List asset names** without reading content

---

## Common Tasks

### Adding a New AI Type
1. Add enum value to `PawnController.AIType`
2. Add case to `ApplyCombinedWeights()` in `PawnController.cs`
3. Add case to `MakeStandoffDecision()` in `PawnController.cs`
4. Create prefab with configured `PawnController` and `Firearm`
5. Add to level configuration

### Adding a New Level
1. Create `LevelData` ScriptableObject
2. Configure all parameters
3. Add to `LevelManager.levels[]`
4. Update `LevelSelectUI` if needed

### Adding a New Firearm Mode
1. Add enum value to `Firearm.FireMode`
2. Implement logic in `Firearm.Update()`
3. Test in both Chess and Standoff modes

### Modifying Platform Generation
1. Edit `Platform.cs` parameters
2. Adjust `GenerateFloorTiles()` for floor layout
3. Modify `GeneratePlatform()` for platform placement
4. Update `MirrorTiles()` for symmetry rules

---

## Testing Workflow

### Chess Mode Testing
1. Verify hex grid generation
2. Test player swipe movement in all 6 directions
3. Test opponent AI for each type
4. Verify turn-based system (Checkerboard)
5. Test opponent shooting (Firearm)
6. Verify player/opponent capture mechanics
7. Test HP system and death

### Standoff Mode Testing
1. Verify platform generation (symmetry, connectivity)
2. Test player platformer controls (movement, jump)
3. Test opponent AI platforming (jumping, edge detection)
4. Verify slow motion effect (move vs idle)
5. Test shooting mechanics
6. Verify win condition (touch opponent)
7. Test transition from Chess → Standoff

### UI Testing
1. Main menu navigation
2. Level selection
3. In-game HUD updates
4. Pause/resume functionality
5. Victory/defeat screens
6. Settings (volume controls)
7. Mobile controls visibility (auto-detect)

---

## Known Limitations

1. **3 Levels Maximum**: Currently configured for 3 levels
2. **Single Opponent in Standoff**: Only supports 1v1 Standoff
3. **Hex Orientation**: Grid uses FlatTop by default
4. **Physics 2D**: Requires Unity Physics 2D package
5. **TextMeshPro**: UI requires TextMeshPro package

---

## Dependencies

- **Unity Version**: 2021.3+ recommended
- **Required Packages**:
  - TextMeshPro
  - Input System (new)
  - 2D Physics

---

## Code Style

- **Naming**: PascalCase for public fields and methods
- **Tooltips**: All public Inspector fields have tooltips
- **Regions**: Code organized with `#region` blocks
- **Comments**: Comprehensive XML-style documentation

---

## Debugging Tips

### Chess Mode Issues
- Check `Checkerboard.IsPlayerTurn()` for turn management
- Verify hex coordinates with `Debug.Log($"q={q}, r={r}")`
- Use `showDebug` flags in controllers
- Check tile names: "Hex_{q}_{r}"

### Standoff Mode Issues
- Verify Rigidbody2D configuration (non-kinematic, gravity=2)
- Check ground layer mask settings
- Test ground detection raycasts (enable Gizmos)
- Verify TimeController.Instance is active

### UI Issues
- Check singleton initialization order
- Verify UnityEvent connections in Inspector
- Test with both mobile and desktop input

---

## Future Enhancement Ideas

1. **More AI Types**: Add specialized behaviors
2. **Power-ups**: Chess mode pickups
3. **Modifiers**: "Fights in Tight Spaces" style modifiers
4. **More Levels**: Expand beyond 3 levels
5. **Multiplayer**: Local or online
6. **Procedural Levels**: Random hex grid layouts
7. **Boss Battles**: Multi-phase Standoff encounters
8. **Replay System**: Record and replay games

---

## Contact & Attribution

This project was developed as a prototype for a 2D Mobile Game Development assignment.

**Inspirations:**
- Shotgun King: The Final Checkmate (Chess + Shooting)
- Fights in Tight Spaces (Enemy Modifiers)
- SUPERHOT (Time Mechanics)

---

*Last Updated: 2025-12-09*
*Total Scripts: 25+*
*Total Lines of Code: 5000+*
